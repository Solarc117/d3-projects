import"./modulepreload-polyfill.b7f2da20.js";import*as s from"https://cdn.skypack.dev/d3@7";const d=s.select(".canvas"),{clientWidth:C,clientHeight:j}=document.querySelector(".canvas"),x=s.geoPath();let l=0;const m=["hsl(120, 100%, 19%)","hsl(209, 100%, 19%)","hsl(0, 100%, 19%)"],i=s.scaleLinear([],["white",m[l]]),P={duration:500,fill:"forwards"};function N(){l++,l>=m.length&&(l=0),i.range(["white",m[l]]);const c=[...document.querySelectorAll(".county"),...document.querySelectorAll(".legend-rect")];for(const n of c)n.animate([{fill:i(n.nodeName==="path"?+n.dataset.bachelors_or_higher:n.__data__[1])}],P)}document.addEventListener("DOMContentLoaded",()=>document.querySelector(".color-toggle").addEventListener("click",N));const q=8,U=200,H=U/q,S=20,h={bottom:10,right:40},X=C-h.right+5,p=s.scaleLinear([],[j-h.bottom,j-h.bottom-H*q]);(async()=>{let c,n;try{[c,n]=await Promise.all([s.json("https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/counties.json"),s.json("https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/for_user_education.json")])}catch(t){console.error(t),alert("Could not load data, please try again")}const k=topojson.feature(c,c.objects.counties).features,R=topojson.feature(c,c.objects.states).features,w=[...n].sort((t,e)=>t.fips-e.fips),E=[...k].sort((t,e)=>t.id-e.id),y=[];for(const[t,e]of w.entries()){const a=E[t];y.push({info:e,topo:a})}const[_,A]=s.extent(n,t=>t.bachelorsOrHigher),[f,g]=[10*Math.floor(_/10),10*Math.ceil(A/10)];i.domain([_,A]),p.domain([f,g]);function T({target:t}){if(document.querySelector(".tooltip").classList.contains("locked"))return;const{state:e,area_name:a,bachelors_or_higher:o}=t.dataset;s.select(".tooltip").html(`${a},<br>${e}<br><br>${o}%`)}function I(){document.querySelector(".tooltip").classList.toggle("locked")}d.selectAll(".county").data(y).enter().append("path").attr("class","county").attr("data-state",t=>t.info.state).attr("data-area_name",t=>t.info.area_name).attr("data-bachelors_or_higher",t=>t.info.bachelorsOrHigher).attr("d",t=>x(t.topo)).style("fill",t=>i(t.info.bachelorsOrHigher)).on("mouseover",T).on("click",I),d.selectAll(".state").data(R).enter().append("path").attr("class","state").attr("d",x);const b=(g-f)/8,L=[];for(let t=f;t<g;t+=b)L.push([t,t+b-.01]);const O=s.axisRight(p).tickFormat(t=>t+"%");d.append("g").attr("class","legend-axis").attr("transform",`translate(${X}, 0)`).call(O);function u(t,e){const a=+t.dataset.bachelors_or_higher;return a>=e[0]&&a<=e[1]}function $({target:t,shiftKey:e,ctrlKey:a}){const o=[t,t.__data__,Array.from(document.querySelectorAll(".county"))];return e&&a?D(...o):e?M(...o):W(...o)}function D(t,e,a){const o=[],v=[],F=Array.from(document.querySelectorAll(".legend-rect"));for(const r of F)r.classList.add("fade");t.classList.remove("fade");for(const r of a)u(r,e)?o.push(r):v.push(r);for(const r of o)r.classList.remove("fade");for(const r of v)r.classList.add("fade")}function M(t,e,a){t.classList.toggle("fade"),a.filter(o=>u(o,e)).forEach(o=>o.classList.toggle("fade"))}function W(t,e,a){t.classList.toggle("highlight"),a.filter(o=>u(o,e)).forEach(o=>o.classList.toggle("highlight"))}d.selectAll("rect").data(L).enter().append("rect").attr("width",S).attr("height",H).attr("x",C-S-h.right).attr("y",t=>p(t[1])).attr("class","legend-rect").style("fill",t=>i(t[1])).on("click",$)})();
