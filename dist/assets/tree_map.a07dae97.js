import"./modulepreload-polyfill.b7f2da20.js";import*as l from"https://cdn.skypack.dev/d3@7";const B=38,f=l.select(".canvas"),A=parseFloat(f.attr("width")),H=parseFloat(f.attr("height"))-B;(async()=>{let C;try{C=await l.json("https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/movie-data.json")}catch(t){console.error(t),alert("Could not load tree map data")}const E=l.hierarchy(C,t=>t.children).sum(t=>t.value).sort((t,a)=>a.value-t.value),F=l.treemap().size([A,H]),$=F(E).leaves(),v=$.map(t=>t.data.category).reduce((t,a)=>t.includes(a)?t:[...t,a],[]),j=l.scaleOrdinal(v,l.schemeCategory10),R=f.selectAll(".cell").data($).enter().append("g").attr("id",({data:t})=>t.name).attr("data-category",({data:t})=>t.category).attr("data-revenue",({data:t})=>t.value).attr("class","cell")._groups[0].map(t=>l.select(t));function S(t){const a=t.data.name,{x1:n,x0:e}=t,o=n-e,y=document.getElementById(a),h=y.children[1],w=t.y0+15;function i(r){return h.innerHTML=r,h.getComputedTextLength()<o-4}function d(r,p=[]){const c=Array.isArray(r)?r:r.split(" ").filter(g=>g).map(g=>i(g)?g:g.slice(0,3)+".");let u=[];for(;c.length>0&&i([u.join(" "),c[0]].join(" "));)u.push(c.shift());return p.push(u.join(" ")),c.length>0?d(c,p):p}function s(r){let p="";for(const[c,u]of r.entries())p+=`<tspan x='${e+2}' y='${w+c*15}'>${u}</tspan> `;return p}return s(d(a))}const x=document.querySelector(".tooltip");R.forEach(t=>{const a=t.data()[0].data;t.append("rect").attr("x",({x0:e})=>e).attr("y",({y0:e})=>e).attr("width",({x1:e,x0:o})=>e-o).attr("height",({y1:e,y0:o})=>e-o).style("fill",({data:e})=>j(e.category)).on("mouseover",({target:e})=>n(e)),t.append("text").attr("x",({x0:e})=>e+3).attr("y",({y0:e})=>e+16).html(S).style("user-select","none").on("mouseover",({target:e})=>n(e));function n(e){function o(w){const i=w.split(""),d=[];for(let s=i.length-3;s>0;s-=3)d.unshift(i.splice(s,3));return d.unshift(i),d.reduce((s,r)=>s.concat(",",r)).join("")}let{x:y,y:h}=e.getBoundingClientRect();y+=window.scrollX,h+=window.scrollY,x.innerHTML=`${a.name} - $${o(a.value)} in revenue.`,x.style.left=`${y}px`,x.style.top=`${h}px`}});const T=A/v.length,m=20,L=H+(B-m)/2;f.selectAll(".legend-cell").data(v).enter().append("g").attr("class","legend-cell")._groups[0].map(t=>l.select(t)).forEach((t,a)=>{t.append("rect").attr("x",()=>a*T+10).attr("y",L).attr("width",m).attr("height",m).style("fill",n=>j(n)),t.append("text").attr("x",()=>a*T+m+15).attr("y",L+15).text(n=>n)})})();
